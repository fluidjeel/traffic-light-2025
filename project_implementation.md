Master Project Context: Traffic Light 2025 (Version 5.1)
Objective: This document provides a comprehensive and explicit overview of the Python-based algorithmic trading project. It reflects the latest architecture, which is built around a unified data pipeline and a suite of fully corrected, bias-free simulators. This document is the single source of truth.

Section 1: High-Level Project Goal & Philosophy
1.1. Goal
The primary objective of this project is to develop, backtest, and ultimately automate a profitable, long-only, swing trading strategy with a verifiable and realistic edge. The strategy is applied to the Nifty 200 stock universe across multiple timeframes.

1.2. Core Philosophy
Our guiding principle is an unwavering commitment to eliminating all forms of bias. All development and testing must be conducted using the final, corrected simulators that have been rigorously audited to remove lookahead biases and critical calculation flaws.

Section 2: System Architecture & The Universal Data Pipeline
The project is a streamlined, modular pipeline designed for rigorous, bias-free research.

Data Acquisition: The universal_fyers_scraper.py script is the single entry point for all data. It intelligently downloads and updates raw daily and 15-minute historical data for all stocks and indices, saving them to a unified data/universal_historical_data/ directory.

Data Processing & Resampling: The universal_calculate_indicators.py script acts as the central data processing engine. It reads the raw daily data, resamples it into higher timeframes (weekly, monthly), calculates all necessary indicators (EMAs, SMAs, RS, ATRs), and saves these clean, enriched data files to a unified data/universal_processed/ directory.

Realistic Simulation: The *_tfl_simulator.py scripts (daily, weekly, monthly) run the strategies in a bias-free manner. They are designed to be flexible, capable of running on either the new universal data pipeline or legacy data folders via a configuration toggle. All simulators have been corrected to fix critical flaws related to position sizing, data timing (VIX), and intraday filter logic.

Post-Hoc Analysis: The mae_analyzer_percent.py script ingests the detailed trade logs generated by the simulators to perform "what-if" simulations for data-driven stop-loss optimization. This also includes the daily_signal_analyzer.py and weekly_signal_analyzer.py scripts for R:R pattern analysis, and daily_signal_characterizer.py and weekly_signal_characterizer.py for winner vs. loser characteristic analysis.

Section 3: The Definitive and Exclusive Trading Strategy Logic
The core of the "Traffic Light 2025" strategy is a pullback continuation pattern. The general logic is to identify a stock in an established uptrend that has experienced a brief pause or "pullback" (represented by one or more red candles) and then resumed its upward momentum (represented by a green candle). This "green-after-red" sequence acts as the "traffic light" signal to prepare for a potential entry.

3.1. The Daily Strategy (daily_tfl_simulator.py)

Setup (EOD, Day T-1): Identifies a green candle closing above its 30-day EMA, preceded by at least one red candle. The setup is only valid if it passes EOD filters for Market Regime (Index > 50-day EMA), Volume (>1.3x average), and Relative Strength.

Entry (Intraday, Day T): Monitors the watchlist and enters on a breakout, provided it passes real-time conviction filters.

3.2. The HTF (Weekly) Strategy (weekly_tfl_simulator.py)

Setup (EOD, Friday): Identifies a green weekly candle closing above its 30-week EMA, preceded by at least one red weekly candle.

Entry (Intraday, Next Week): Monitors for a daily price breakout above the high of the weekly setup pattern. The entry is validated against the same conviction filters as the daily strategy.

3.3. The Monthly Strategy (monthly_tfl_simulator.py)

Setup (EOD, Month-End): Identifies a green monthly candle preceded by at least one red monthly candle. Optional filters for EMA and volume can be applied.

Entry (Intraday, Next Month): Monitors for a daily price breakout above the high of the monthly setup pattern within an adaptive execution window.

3.4. Universal Trade Management Rules (Corrected & Bias-Free)

Position Sizing: All simulators now correctly calculate position size based on the real-time available cash balance, preventing the leveraging of unrealized profits.

VIX Data Timing: All intraday decisions (for slippage, profit targets, etc.) correctly use the VIX closing value from the previous trading day (T-1), ensuring no lookahead bias.

Stop-Loss: Can be configured to use a fixed percentage or a lookback to the lowest low of recent candles.

Profit Target (Monthly): The monthly simulator features a VIX-scaled R:R target, aiming for higher rewards in calm markets and lower rewards in volatile markets.

Trailing Stop: All simulators use a percentage-based buffer for the aggressive breakeven logic to ensure it scales correctly with stock price.

Section 4: Strategy Timeline and Execution Flow
This section describes the practical, time-based sequence of events for each strategy as implemented in the final, bias-free simulators.

4.1. The Daily Strategy (daily_tfl_simulator.py)
This strategy operates on a two-day cycle: setup identification on Day T-1 and potential execution on Day T.

After Market Close on Day T-1: The system scans the daily charts for the core pullback pattern and applies EOD quality filters to generate a "Watchlist" for the next day.

During the Trading Day on Day T: The system monitors the 15-minute data for stocks on the Watchlist. When a stock breaks its trigger price, it runs the real-time "Advanced Conviction & Risk Engine" before executing a trade.

4.2. The HTF (Weekly) Strategy (weekly_tfl_simulator.py)
This strategy uses a weekly cadence, separating setup discovery ("Scouting") from trade execution ("Sniping").

Post-Market / End-of-Day (EOD) on Friday (The "Scout" Mission): The Scout scans the weekly charts for the core pullback pattern. For each valid setup, it generates a "Target List" for the entire upcoming week.

Intraday during the Following Week, Monday to Friday (The "Sniper" Mission): The Sniper monitors the 15-minute data for stocks on the Target List. When a breakout occurs, it validates the move using the full Advanced Conviction & Risk Engine before entering.

4.3. The Monthly Strategy (monthly_tfl_simulator.py)
This strategy adapts the Scout/Sniper model for a much longer timeframe.

After Market Close on the Last Trading Day of the Month (The "Scout" Mission): The Scout scans the monthly charts for the core pullback pattern. It applies quality filters and generates a "Target List" valid for the entire next month.

During the Following Month (The "Sniper" Mission): The Sniper monitors the Target List intraday. It operates within an Adaptive Execution Window, typically ignoring the first few volatile days of the month and then monitoring for a set period for a breakout, which is then validated against the Conviction Engine.

Section 5: The Bias-Free Simulators & Core Engines
5.1. The Simulators
The project now relies on a suite of three unified, flexible, and fully corrected simulators: daily_tfl_simulator.py, weekly_tfl_simulator.py, and monthly_tfl_simulator.py. Each is capable of running against both the modern universal data pipeline and legacy data folders via a configuration toggle.

5.2. The Advanced Conviction & Risk Engine
This engine is a core component of all simulators. It is a suite of bias-free, intraday filters used to validate entry signals.

Time-Anchored Volume Projection: Projects final EOD volume based on cumulative intraday volume at specific time anchors.

VIX-Adaptive Market Strength & Slippage: Adjusts market health thresholds and slippage based on the previous day's VIX close.

Intraday Relative Strength (RS) Filter: Compares the stock's intraday performance against the index's performance at the moment of breakout.

Integrated Portfolio Risk Gate: Correctly calculates position size based on both per-trade risk and total portfolio risk exposure, using the real-time available cash balance to prevent leveraging unrealized profits.

Section 6: Strategic Roadmap & Current Status
6.1. Strategic Roadmap

Phase 0-2 (Complete): Foundational Validation, Core Risk Architecture, and Conviction Engine development are complete.

Phase 3 (In Progress): Address Systemic Backtesting Flaws.

Phase 3.5 (Next): Advanced Strategy Analysis & Optimization. This phase now includes the development and use of dedicated scanner, analyzer, and characterizer scripts for each timeframe to systematically identify, evaluate, and refine entry signal filters.

Phase 4 (Future): Predictive Modeling.

6.2. The Professional Strategy Analysis Checklist
This checklist is the official guide for Phase 3.5 of the project.

✅ 1. Excursion Analysis (MAE & MFE)

Objective: To analyze the price journey of each trade to optimize stop-loss and profit-taking rules.

Actionable Insights: Set a tighter atr_multiplier_stop based on MAE analysis of winners. Introduce a more conservative or dynamic profit target based on MFE analysis of losers.

✅ 2. Trade Duration Analysis

Objective: To determine if there is an optimal holding period for trades.

Actionable Insights: Implement time-based stops (e.g., "slow mover exit") if analysis reveals that trades held beyond a certain duration are more likely to fail.

✅ 3. Equity Curve & Drawdown Analysis

Objective: To understand the frequency, duration, and depth of drawdowns.

Actionable Insights: Use the analysis to refine risk parameters and for psychological preparedness for live trading.

✅ 4. Regime Analysis

Objective: To identify the specific market environments where the strategy thrives and where it struggles.

Actionable Insights: Implement a master "regime filter" to disable the strategy during unfavorable market conditions or dynamically adjust position sizing based on the regime.

✅ 5. Portfolio Construction & Correlation Analysis

Objective: To prevent large drawdowns caused by over-concentration in a single factor (e.g., a specific sector).

Actionable Insights: Implement portfolio-level risk controls such as:

Volatility-Adaptive Position Sizing: Risk less on highly volatile stocks and more on stable stocks.

Sector Exposure Caps: Set a hard limit on the capital allocated to any single market sector.

Correlation-Based Diversification: Reject new trades that are too highly correlated with existing open positions.

6.3. Current Project Status & Immediate Next Steps

Current Status: The project has successfully migrated to a unified, streamlined data pipeline. The suite of simulators has been rigorously audited and corrected, eliminating all known lookahead biases and critical calculation flaws. The project is now in a robust state, ready for methodical strategy research and optimization.

Immediate Next Steps: The focus now shifts from fixing flaws to stress-testing and refining the strategies.

Enable Conviction Filters: Methodically enable the conviction filters (EMA, Volume, Market Strength, Regime Filters) in the simulator configurations to build more robust strategies.

Perform Robustness Checks: Use new features (like exit slippage randomization and regime filters) to stress-test the strategies and understand their performance under different market conditions.

Address Systemic Biases: Resume work on mitigating systemic biases like survivorship bias by implementing a solution for using point-in-time historical index constituents.